name: Keep Render Server Alive

on:
  schedule:
    # æ¯13åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ - é¿å…Renderå…è´¹å±‚ä¼‘çœ 
    # GitHub Actionsçš„cronè¯­æ³•ï¼šåˆ†é’Ÿ å°æ—¶ æ—¥ æœˆ æ˜ŸæœŸ
    # */13 è¡¨ç¤ºæ¯13åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    - cron: '*/13 * * * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping Render Server
      run: |
        echo "ğŸš€ å¼€å§‹æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€..."
        echo "â° å½“å‰æ—¶é—´: $(date)"
        
        # è®¾ç½®ç›®æ ‡URL
        URL="https://dconaninfosearch.onrender.com/ping"
        
        # å‘é€HTTPè¯·æ±‚å¹¶è®°å½•ç»“æœ
        echo "ğŸ“¡ æ­£åœ¨ping: $URL"
        
        # ä½¿ç”¨curlå‘é€è¯·æ±‚ï¼Œè®¾ç½®è¶…æ—¶å’Œé‡è¯•
        response=$(curl -s -w "\nçŠ¶æ€ç : %{http_code}\nå“åº”æ—¶é—´: %{time_total}s\nå¤§å°: %{size_download} bytes" \
          --max-time 30 \
          --retry 3 \
          --retry-delay 5 \
          --user-agent "GitHub-Actions-KeepAlive/1.0" \
          "$URL" || echo "è¯·æ±‚å¤±è´¥")
        
        echo "ğŸ“Š å“åº”ç»“æœ:"
        echo "$response"
        
        # æ£€æŸ¥å“åº”æ˜¯å¦åŒ…å«"alive"
        if echo "$response" | grep -q "alive"; then
          echo "âœ… æœåŠ¡å™¨çŠ¶æ€æ­£å¸¸"
          echo "ğŸ¯ æˆåŠŸé˜²æ­¢RenderæœåŠ¡å™¨ä¼‘çœ "
        else
          echo "âš ï¸ æœåŠ¡å™¨å“åº”å¼‚å¸¸ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥"
          # ä¸è®©workflowå¤±è´¥ï¼Œå› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªkeep-aliveä»»åŠ¡
        fi
        
        echo "â° å®Œæˆæ—¶é—´: $(date)"
        echo "ğŸ”„ ä¸‹æ¬¡æ£€æŸ¥å°†åœ¨13åˆ†é’Ÿåè¿›è¡Œ"

    - name: Log Keep-Alive Activity
      run: |
        echo "ğŸ“ è®°å½•ç›‘æ§æ´»åŠ¨"
        echo "ä»»åŠ¡ID: ${{ github.run_id }}"
        echo "å·¥ä½œæµ: ${{ github.workflow }}"
        echo "è§¦å‘äº‹ä»¶: ${{ github.event_name }}"
        
        # ç®€å•çš„çŠ¶æ€ç»Ÿè®¡
        if [ "${{ github.event_name }}" = "schedule" ]; then
          echo "ğŸ¤– è‡ªåŠ¨å®šæ—¶ä»»åŠ¡æ‰§è¡Œ"
        else
          echo "ğŸ‘¤ æ‰‹åŠ¨è§¦å‘æ‰§è¡Œ"
        fi